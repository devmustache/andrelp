---
const { nome, imagem, restaurante } = Astro.props;
---
<style>
.card-wrapper {
  width: 260px;
  height: 360px;
  perspective: 1400px;
  flex-shrink: 0;
  position: relative;
}

/* Hover apenas para desktop (quando wrapper NÃO tem .mobile) */
@media (hover: hover) and (pointer: fine) {
  .card-wrapper:not(.mobile):hover .card {
    transform: rotateY(180deg);
  }
}

.card {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.8s cubic-bezier(.03,.58,.48,1);
  /* ajuda no comportamento de toque */
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* Frente e verso */
.front,
.back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 18px;
  overflow: hidden;
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.25);
  background: #fff;
}

.front img {
  width: 100%;
  height: 75%;
  object-fit: cover;
}

.front h2 { text-align: center; padding: 12px; font-size: 1.25rem; font-weight: 600; }

.back {
  background: linear-gradient(135deg, #111, #222);
  color: #f6f6f6;
  transform: rotateY(180deg);
  padding: 22px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 10px;
}

.flipped { transform: rotateY(180deg); }

/* Mensagem no mobile */
.tap-info { text-align: center; font-size: 0.80rem; margin-top: 8px; color: #777; }


</style>

<div class="card-wrapper">
  <div class="card">
    <div class="front">
      <img src={imagem} alt={nome} />
      <h2>{nome}</h2>
    </div>

    <div class="back">
      <h3>{restaurante.nome}</h3>
      <p>{restaurante.descricao}</p>
      <p><strong>Avaliação:</strong> {restaurante.rating}</p>
    </div>
  </div>
</div>

<div class="tap-info" style="display:none">Toque para virar a carta</div>


<!-- Script robusto: detecta touch no client e aplica comportamento -->
<script is:inline>
  (function () {
    function isTouchDevice() {
      return (('ontouchstart' in window) ||
              (navigator.maxTouchPoints && navigator.maxTouchPoints > 0) ||
              window.matchMedia && window.matchMedia('(pointer: coarse)').matches);
    }

    function initFlip() {
      const touch = isTouchDevice();
      const wrappers = document.querySelectorAll('.card-wrapper');
      wrappers.forEach(wrapper => {
        // marca mobile apenas client-side para controlar CSS de hover
        if (touch) wrapper.classList.add('mobile');

        const card = wrapper.querySelector('.card');
        if (!card) return;

        // evita anexar múltiplas vezes
        if (wrapper.__flipAttached) return;
        wrapper.__flipAttached = true;

        // click para virar
        wrapper.addEventListener('click', (e) => {
          const tag = e.target && e.target.closest && e.target.closest('a,button');
          if (tag) return;
          card.classList.toggle('flipped');
        }, { passive: true });
      });

      const tip = document.querySelector('.tap-info');
      if (tip) tip.style.display = touch ? 'block' : 'none';
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initFlip);
    } else {
      initFlip();
    }
  })();
</script>
