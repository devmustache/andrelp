---
import Picture from "@components/media/Picture.astro";
const { slot, ...props } = Astro.props;
import Intersecting from "@components/common/Intersecting.vue";
import { t } from "@util/translate";

// Pega o nome e extens√£o do arquivo
const imageName = props.src.split("/").pop().split(".")[0];
const imgAlt = imageName ? imageName : "no-name";
const ext = props.src.split(".").pop();

// Detecta se √© SVG
function isPixelBasedImage(extension) {
  const pixelBasedFormats = [
    "jpg",
    "jpeg",
    "png",
    "gif",
    "bmp",
    "tiff",
    "webp",
    "ico",
  ];
  return pixelBasedFormats.includes(extension.toLowerCase());
}
const isSvg = !isPixelBasedImage(ext);

// üü¢ Aqui pegamos o image_size vindo do MDX
// Se image_size existir, usamos ele como width.
// Se n√£o existir, N√ÉO for√ßamos width (o Picture se vira sozinho).
const dynamicWidth = props.media?.image_size
  ? Number(props.media.image_size)
  : undefined;
---
{
  !isSvg && (
    <Intersecting client:visible>
      <a
        href={`/images/${imgAlt}`}
        class="img fade-up block"
        transition:name={`image_${imgAlt}`}
        aria-label={t("enlarge_image")}
      >
        <Picture
          {...props}
          alt={imgAlt}
          width={dynamicWidth}
        />
      </a>
    </Intersecting>
  )
}

{isSvg && <img {...props} alt={imgAlt} class="w-full h-auto" />}
